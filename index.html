<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Monty Hall</title>
    <link rel="stylesheet" type="text/css" href="./css/style.css">

    <!--Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <!--jQuery library-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <!--Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

</head>
<body>
    

	    <div id="doorContainer">

	    	<div class="behindDoor">

	    		<div id="leftDoor" class="door unlocked">
	            	<img src="./media/door/0.png" hidden>
	       		</div>

	    	</div>
	        
	    	<div class="behindDoor">
		        <div id="centralDoor" class="door unlocked">
		            <img src="./media/door/0.png" hidden>
		        </div>
		    </div>

		    <div class="behindDoor">
		        <div id="rightDoor" class="door unlocked">
		            <img src="./media/door/0.png" hidden>
		        </div>
		   	</div>

	        <div id="pendingDialog" style="vertical-align: middle;">
	            <p  style="color: red">
	                <b>Are you sure you want to open this door?</b>
	            </p>
	        </div>
            <br>

            <button id="reset" style="float: right;" type="button" class="btn btn-warning">RESET PLAY</button>
            <button id="resetData" style="float: right;" type="button" class="btn btn-warning">RESET DATA</button>

            <div class="input-group">
                <input type="number" id="autoplayInput" class="form-control"  min="1" value="1">
                <div class="input-group-append">
                    <button class="btn btn-primary" id="goAutoplay" type="button">GO</button>
                </div>
            </div>

            <button id="KeepChoice" style="float: left;" type="button" class="btn btn-success btn-lg">Keep Choice</button>
            <div style="margin-top: 50px;"></div>

            <div class="mt-2 mt-md-0 d-flex">
                <div class="alert alert-success monty__indicator align" style="width: 50%;" id="Keep_Win">Cars: 0 | <strong>50%</strong></div>
                <div class="alert alert- btn-danger monty__indicator align" style="width: 50%;" id="Keep_Lose">Goats: 0 | <strong>50%</strong></div>
            </div>

            <div style="margin-top: 50px;"></div>



            <button id="ChangeChoice" style="float: left;" type="button" class="btn btn-danger btn-lg">Change Choice</button>
            <br>
            <div style="margin-top: 30px;"></div>

            <div class="mt-2 mt-md-0 d-flex">
                <div class="alert alert-success monty__indicator align" style="width: 50%;" id="Change_Win">Cars: 0 | <strong>50%</strong></div>
                <div class="alert alert- btn-danger monty__indicator align" style="width: 50%;" id="Change_Lose">Goats: 0 | <strong>50%</strong></div>
            </div>
            
	    </div>


    <!-- SPIEGAZIONE CLASSI
        .unlocked Indica che la porta può essere cliccata. Se questa classe non è presente, il click handler non si attiva
        .pending Indica che la porta è stata scelta all'inizio. La porta apparirà come socchiusa e verrà mostrato il messaggio se si è sicuri della scelta
        .open Fa partire l'animazione della porta che si apre.
    -->
    <script>

        var pendingDoor = ""; //Non togliere
        var KeepChoice = true; //Non togliere

        var Win = true;
        var Keep = 0;
        var Change = 0;
        var Win_Keep = 0;
        var Lose_Keep = 0;
        var Win_Change = 0;
        var Lose_Change = 0;
        var Cars_Keep = 0;
        var Goats_Keep = 0;
        var Cars_Change = 0;
        var Goats_Change = 0;

        function openRandomDoor() {
            console.log("Opening random door...");
            console.log($(".door"));
            var random = Math.round(Math.random());
            console.log("Revealing door ",random);
            var $closedDoors =$(".door").not(".pending");
            $($closedDoors[random]).addClass('open').removeClass('unlocked').off();
            $($closedDoors[random]).parent().css('background-image', 'url("./media/c.png")');
        }


        function setup(){//Questa funzione viene richiamata per ripristinare ai valori di default tutte le variabili
            $('#pendingDialog').hide();

            $doors=$(".door").removeClass();
            $doors.addClass('door');
            $doors.addClass('unlocked');

            $('.behindDoor').css('background-image', 'none');

            $(".door").off();//Rimuove tutti gli handlers

            $(".door.unlocked").click(function(){
                if ($(".door.pending").length == 0){ //Se è la prima volta che si sceglie la porta
                    console.log("Added class 'pending'");

                    pendingDoor = $(this).attr('id');
                    console.log(pendingDoor);

                    $(this).addClass('pending');// Fa sì che la porta appaia come socchiusa
                    $(this).append($('#pendingDialog'));//Fa apparire il testo sulla porta appena scelta
                    $('#pendingDialog').show();
                    openRandomDoor();
                }else{//Altrimenti vuol dire che ho deciso la porta finale
                    console.log("Chose final door");

                    $(".door").removeClass('unlocked');//Fa sì che non si possano aprire altre porte
                    $(".door").off("click");//Rimuove gli handler (in particolare del click) dalle porte

                    $(".door.pending").removeClass('pending');
                    $('#pendingDialog').hide();

                    $(this).addClass('open');

                    if($(this).attr('id') != pendingDoor){
                        KeepChoice = false;
                    }
                    else{ //added else so that variable is not based on reset 
                        KeepChoice = true;
                    }

                    console.log(KeepChoice);


                    switch(Math.round(Math.random())){
                    	case 0: 
                    		$(this).parent().css('background-image', 'url("./media/c.png")');
                            Win = false;
                            ChangeGraphic();
                    	break;

                    	case 1:
                    		$(this).parent().css('background-image', 'url("./media/m.png")');
                            Win = true;
                            ChangeGraphic();
                    	break;
                    }


                }
            });
        }

        function ChangeGraphic(){
            if(KeepChoice && Win){

                Keep++;
                Win_Keep++;
                Cars_Keep++;
                var percentual = (Win_Keep/Keep)*100;

                if(Keep == Win_Keep){
                    $('#Keep_Win').html("Cars: "+Cars_Keep +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Keep_Lose').html("Goats: 0" +" | <strong>"+"0%"+"</strong>");
                }
                else{
                    $('#Keep_Win').html("Cars: "+Cars_Keep +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Keep_Win').css("width",percentual+"%");
                    $('#Keep_Lose').html("Goats: "+Goats_Keep +" | <strong>"+(100-percentual)+"%"+"</strong>");
                    $('#Keep_Lose').css("width",(100-percentual)+"%");    
                }
            }
            else if(KeepChoice && Win == false){

                Keep++;
                Lose_Keep++;
                Goats_Keep++;
                var percentual = (Lose_Keep/Keep)*100;


                if(Keep == Lose_Keep){
                    $('#Keep_Lose').html("Goats: "+Goats_Keep +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Keep_Win').html("Cars: 0" +" | <strong>"+"0%"+"</strong>");
                }
                else{
                    $('#Keep_Lose').html("Goats: "+Goats_Keep +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Keep_Lose').css("width",percentual+"%");   
                    $('#Keep_Win').html("Cars: "+Cars_Keep +" | <strong>"+(100-percentual)+"%"+"</strong>");
                    $('#Keep_Win').css("width",(100-percentual)+"%");  
                }
            }
            else if(ChangeChoice && Win){

                Change++;
                Win_Change++;
                Cars_Change++;

                console.log(Change,Change_Win,Cars_Change);

                var percentual = (Win_Change/Change)*100;

                if(Change == Win_Change){
                    $('#Change_Win').html("Cars: "+Cars_Change +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Change_Lose').html("Goats: 0" +" | <strong>"+"0%"+"</strong>");
                }
                else{
                    $('#Change_Win').html("Cars: "+Cars_Change +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Change_Win').css("width",percentual+"%");
                    $('#Change_Lose').html("Goats: "+Goats_Change +" | <strong>"+(100-percentual)+"%"+"</strong>");
                    $('#Change_Lose').css("width",(100-percentual)+"%");    
                }
            }
            else if(ChangeChoice && Win == false){

                Change++;
                Lose_Change++;
                Goats_Change++;
                var percentual = (Lose_Change/Change)*100;

                if(Change == Lose_Change){
                    $('#Change_Lose').html("Goats: "+Goats_Change +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Change_Win').html("Cars: 0" +" | <strong>"+"0%"+"</strong>");
                }
                else{
                    $('#Change_Lose').html("Goats: "+Goats_Change +" | <strong>"+percentual+"%"+"</strong>");
                    $('#Change_Lose').css("width",percentual+"%");
                    $('#Change_Win').html("Goats: "+Cars_Change +" | <strong>"+(100-percentual)+"%"+"</strong>");
                    $('#Change_Win').css("width",(100-percentual)+"%"); 
                }
            }


        }
        function autoplay($n){ //Recursive function that simulates the user clicking on the doors (aka playing the game) for a give $n times
            if ($n > 0){
                $('#reset').trigger('click');                   //Resets all the doors to default


                //////
                //First click simulation
                $random = Math.round((Math.random() * 2));      //Random between 0 and 2 (3 doors)
                var $clickableDoors =$(".door.unlocked");       //All clickable doors
                $($clickableDoors[$random]).trigger('click');   //Triggers a click event on the randomly chosen door
                //////////
                //Second Click simulation
                $random = Math.round((Math.random()));          //Random between 0 an 1 (remaining 2 doors)
                var $clickableDoors =$(".door.unlocked");       //All clickable doors
                $($clickableDoors[$random]).trigger('click');   //Triggers a click event on the randomly chosen door
                ///////

                $('#autoplayInput').attr('value',$n);           //Just for aesthetics. Sets the input number of the autoplay to the remaining plays to execute
                $n--;
                if ($n >0){ //If there are more plays to simulate, it calls another time autoplay()
                    setTimeout(autoplay($n),1); //Executes autoplay() after 1 millisecond. In order to avoid lag
                }

            }
        }
        setup();

        $('#reset').click(function(){
            setup();
        });

        $('#resetData').click(function(){
            Win = true;
            Keep = 0;
            Change = 0;
            Win_Keep = 0;
            Lose_Keep = 0;
            Win_Change = 0;
            Lose_Change = 0;
            Cars_Keep = 0;
            Goats_Keep = 0;
            Cars_Change = 0;
            Goats_Change = 0;

            $('#Keep_Win').html("Cars: 0" +" | <strong>"+"50%"+"</strong>");
            $('#Keep_Win').css("width","50%");
            $('#Keep_Lose').html("Goats: 0" +" | <strong>"+"50%"+"</strong>");
            $('#Keep_Lose').css("width","50%");   


            $('#Change_Win').html("Cars: 0" +" | <strong>"+"50%"+"</strong>");
            $('#Change_Win').css("width","50%");
            $('#Change_Lose').html("Goats: 0" +" | <strong>"+"50%"+"</strong>");
            $('#Change_Lose').css("width","50%");  

        });

        $('#goAutoplay').click(function(){
            $('#reset').trigger('click');
            autoplay($('#autoplayInput').val());
        });

        $("document").ready(function(){
            $('#pendingDialog').hide();
        })

    </script>

</body>
</html>

